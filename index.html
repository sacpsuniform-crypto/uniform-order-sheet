<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SA College Private School - Uniform Order</title>

  <!-- =========================
       Libraries
       - EmailJS for sending emails
       - jsPDF + AutoTable for PDF generation
       ========================= -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){
      try {
        emailjs.init("GEyF3k2gS9_KFma8Y");
        console.log("EmailJS initialized");
      } catch (e) {
        console.warn("EmailJS init failed:", e);
      }
    })();
  </script>

  <!-- jsPDF and autotable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root{
      --navy: #00274d;
      --gold: #ffc107;
      --white: #ffffff;
      --muted: #f4f6f8;
      --accent: #0f7b3a;
    }
    html,body{
      margin:0;
      padding:0;
      height:100%;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--muted);
      color:#111;
    }

    /* Header */
    header.site-header{
      background: linear-gradient(90deg, rgba(0,39,77,1) 0%, rgba(0,39,77,0.95) 60%);
      color:var(--white);
      padding:14px 20px;
      display:flex;
      gap:18px;
      align-items:center;
    }
    header.site-header img.logo{
      height:78px;
      width:auto;
      border-radius:8px;
      box-shadow:0 3px 8px rgba(0,0,0,0.2);
      background:var(--white);
      padding:4px;
    }
    header.site-header .heading{
      line-height:1.05;
    }
    header.site-header .heading h1{
      font-size:20px;
      margin:0;
      color:var(--white);
      letter-spacing:0.2px;
    }
    header.site-header .heading p{
      margin:3px 0 0 0;
      font-size:13px;
      color: rgba(255,255,255,0.9);
    }

    /* Braten notice below header */
    .braten-notice{
      background:#ffc;
      border-left:5px solid var(--gold);
      padding:10px 18px;
      margin-bottom:12px;
      font-size:13px;
      color:#111;
    }

    /* Page wrapper */
    .page {
      max-width:1200px;
      margin:18px auto;
      padding:10px;
    }

    /* Form layout */
    form#orderForm {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
    }

    /* Left column */
    .left {
      background:var(--white);
      border-radius:10px;
      padding:18px;
      box-shadow:0 4px 10px rgba(0,0,0,0.04);
    }
    .left .section { margin-bottom:14px; }

    .form-row { display:flex; gap:12px; margin-bottom:10px; }
    .form-row .field { flex:1; }
    label{
      display:block;
      font-size:13px;
      margin-bottom:6px;
      color:#222;
    }
    input[type="text"], input[type="email"], select {
      width:100%;
      padding:8px 10px;
      border-radius:6px;
      border:1px solid #d7dbe0;
      font-size:14px;
      box-sizing:border-box;
      background:#fff;
    }

    /* Product category cards */
    .category-card {
      border-radius:8px;
      background:linear-gradient(180deg, #ffffff 0%, #fcfcfc 100%);
      border:1px solid #e8eef7;
      padding:10px;
      margin-bottom:12px;
    }
    .category-card .cat-header{
      background:var(--navy);
      color:var(--white);
      padding:8px 10px;
      border-radius:6px;
      font-weight:700;
      margin:-10px -10px 10px -10px;
    }

    /* Size & Qty subheading above products */
    .subheading-size-qty {
      font-weight:700;
      font-size:13px;
      margin:8px 0;
      display:flex;
      gap:10px;
    }
    .subheading-size-qty div {
      width:auto;
      text-align:left;
    }
    .subheading-size-qty .size-col { width:110px; text-align:center; }
    .subheading-size-qty .qty-col { width:70px; text-align:center; }

    .product-row{
      display:flex;
      gap:10px;
      align-items:center;
      padding:8px 0;
      border-bottom:1px dashed #eef3fb;
    }
    .product-row:last-child{ border-bottom:none; }
    .product-row .pname { flex:1; font-weight:600; color:#222; font-size:14px; }
    .product-row select.size { width:110px; padding:6px; border-radius:6px; border:1px solid #d7dbe0; }
    .product-row input.qty { width:70px; padding:6px; border-radius:6px; border:1px solid #d7dbe0; }

    /* Right column - cart */
    .cart {
      background:var(--white);
      border-radius:10px;
      padding:16px;
      box-shadow:0 4px 10px rgba(0,0,0,0.04);
      position:sticky;
      top:18px;
      height:fit-content;
      min-height:200px;
    }
    .cart h3{ margin-top:0; color:var(--navy); }
    table.cart-table{
      width:100%;
      border-collapse:collapse;
      margin-top:8px;
      font-size:14px;
    }
    table.cart-table th, table.cart-table td {
      padding:8px 6px;
      border:1px solid #e6e9ee;
      text-align:left;
    }
    table.cart-table th{
      background:var(--navy);
      color:var(--white);
      font-weight:600;
      font-size:13px;
    }
    .cart .total {
      margin-top:10px;
      font-weight:700;
      font-size:16px;
      color:#111;
    }

    /* Buttons */
    .btn {
      display:inline-block;
      padding:10px 14px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:14px;
    }
    .btn-primary {
      background:var(--navy);
      color:var(--white);
    }
    .btn-gold {
      background:var(--gold);
      color:#111;
      margin-top:12px;
      width:100%;
    }

    /* Responsive */
    @media(max-width:980px){
      form#orderForm { grid-template-columns: 1fr; }
      .cart { position:relative; top:auto; }
    }

    .muted { color:#6b7280; font-size:13px; }
    .spaced { margin-top:8px; margin-bottom:8px; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header" role="banner">
    <img class="logo" id="schoolLogo" src="logo.jpg" alt="SA College Private School logo" />
    <div class="heading">
      <h1>SA College Private School</h1>
      <p class="muted">admin@sacps.co.za • info@sacps.co.za • uniformsacps@gmail.com • Tel: 012 326 4580 / 064 548 9428</p>
    </div>
  </header>

  <!-- Braten notice -->
  <div class="braten-notice">
    SA College private school is using Reaora in an attempt to provide uniforms at a more affordable price to parents. SACPS will still be using Select Outfitters and parents are welcome to use them. All orders placed now will be delivered at school and given to your child before the last day of school, ready for January 2026 with no need to stand in queues.
  </div>

  <!-- Main content -->
  <main class="page" role="main">
    <form id="orderForm" autocomplete="off">
      <div class="left" role="region" aria-label="Order and products">
        <div class="section" id="infoSection">
          <h2 style="margin-top:0; color:var(--navy)">Parent & Learner Information</h2>
          <div class="form-row">
            <div class="field"><label for="parentName">Parent Name</label><input id="parentName" type="text" required placeholder="e.g. Thandi Mbeki"></div>
            <div class="field"><label for="contactNumber">Contact Number</label><input id="contactNumber" type="text" required placeholder="e.g. 072 000 0000"></div>
          </div>
          <div class="form-row">
            <div class="field"><label for="email">Email</label><input id="email" type="email" required placeholder="parent@example.com"></div>
            <div class="field"><label for="learnerName">Learner Name</label><input id="learnerName" type="text" required placeholder="e.g. Sipho M"></div>
          </div>
          <div class="form-row">
            <div class="field"><label for="grade">Grade</label><input id="grade" type="text" required placeholder="e.g. Grade 7A"></div>
            <div class="field"><label for="schoolLevel">School Level</label><select id="schoolLevel"><option>Primary</option><option>Highschool</option></select></div>
            <div class="field"><label for="adminNumber">Admin Number</label><input id="adminNumber" type="text" required placeholder="e.g. 45125"></div>
          </div>
        </div>

        <!-- Products -->
        <div class="section" id="productsSection">
          <h2 style="margin-top:0; color:var(--navy)">Uniforms & Sports</h2>

          <!-- Tracksuits -->
          <div class="category-card" id="cat-tracksuits">
            <div class="cat-header">Tracksuits</div>
            <div class="subheading-size-qty"><div>Item</div><div class="size-col">Size</div><div class="qty-col">Quantity</div></div>
            <div class="card-body"></div>
          </div>

          <!-- Jerseys & Pullovers -->
          <div class="category-card" id="cat-jerseys">
            <div class="cat-header">Jerseys & Pullovers</div>
            <div class="subheading-size-qty"><div>Item</div><div class="size-col">Size</div><div class="qty-col">Quantity</div></div>
            <div class="card-body"></div>
          </div>

          <!-- Formal -->
          <div class="category-card" id="cat-formal">
            <div class="cat-header">Formal</div>
            <div class="subheading-size-qty"><div>Item</div><div class="size-col">Size</div><div class="qty-col">Quantity</div></div>
            <div class="card-body"></div>
          </div>

          <!-- Sportswear -->
          <div class="category-card" id="cat-sports">
            <div class="cat-header">Sportswear</div>
            <div class="subheading-size-qty"><div>Item</div><div class="size-col">Size</div><div class="qty-col">Quantity</div></div>
            <div class="card-body"></div>
          </div>

          <!-- Accessories -->
          <div class="category-card" id="cat-accessories">
            <div class="cat-header">Accessories</div>
            <div class="subheading-size-qty"><div>Item</div><div class="size-col">Size</div><div class="qty-col">Quantity</div></div>
            <div class="card-body"></div>
          </div>

        </div>
      </div>

      <!-- RIGHT - cart & submit -->
      <aside class="cart" role="region" aria-label="Cart and submit">
        <h3>Your Cart</h3>
        <div class="muted">Add quantities for the items on the left and the cart will update automatically.</div>
        <table class="cart-table" aria-live="polite" id="cartTable">
          <thead>
            <tr>
              <th style="width:42%;">Item</th>
              <th style="width:18%;">Size</th>
              <th style="width:10%;">Qty</th>
              <th style="width:14%;">Line</th>
              <th style="width:10%;">Remove</th>
            </tr>
          </thead>
          <tbody id="cartBody">
            <tr><td colspan="5" class="muted">No items</td></tr>
          </tbody>
        </table>

        <div class="total" id="grandTotal">Total: R0.00</div>
 <!-- 💳 Payment Information Section -->
        <div id="paymentNotice" class="spaced muted">
          Orders will be collected and paid at school. The total will be sent to your email.
        </div>

        <button type="button" id="generatePDF" class="btn btn-primary">Generate PDF</button>
        <button type="button" id="sendEmail" class="btn btn-gold">Send Order</button>
      </aside>
    </form>
  </main>

  <script>
    // =======================
    // Product data (prices +10%)
    const products = {
      "Primary Tracksuit Set": {category:"cat-tracksuits", price:660, sizes:["5-6","6-7","7-8","8-9","9-10","10-11","11-12","12-13","13-14"]},
      "Highschool Tracksuit Set": {category:"cat-tracksuits", price:715, sizes:["13-14","14-15","15-16","16-17","17-18","18-20"]},
      "Primary Jersey": {category:"cat-jerseys", price:220, sizes:["5-6","6-7","7-8","8-9","9-10","10-11","11-12","12-13","13-14"]},
      "Highschool Jersey": {category:"cat-jerseys", price:275, sizes:["13-14","14-15","15-16","16-17","17-18","18-20"]},
      "Formal Shirt Primary": {category:"cat-formal", price:220, sizes:["5-6","6-7","7-8","8-9","9-10","10-11","11-12","12-13","13-14"]},
      "Formal Shirt Highschool": {category:"cat-formal", price:330, sizes:["13-14","14-15","15-16","16-17","17-18","18-20"]},
      "Sports Short": {category:"cat-sports", price:165, sizes:["5-6","6-7","7-8","8-9","9-10","10-11","11-12","12-13","13-14","14-15","15-16","16-17","17-18","18-20"]},
      "Cap": {category:"cat-accessories", price:55, sizes:["S","M","L","XL"]}
    };

    // =======================
    // Generate product UI
    for(const [name, info] of Object.entries(products)){
      const catDiv = document.querySelector("#"+info.category+" .card-body");
      if(!catDiv) continue;
      const row = document.createElement("div");
      row.className = "product-row";
      row.innerHTML = `<div class="pname">${name} (R${info.price})</div>
      <select class="size">${info.sizes.map(s=>`<option>${s}</option>`).join('')}</select>
      <input type="number" class="qty" min="0" value="0">`;
      catDiv.appendChild(row);
    }

    // =======================
    // Cart logic
    const cart = [];
    function updateCart(){
      const cartBody = document.getElementById("cartBody");
      cartBody.innerHTML="";
      let total=0;
      document.querySelectorAll(".product-row").forEach(row=>{
        const pname=row.querySelector(".pname").innerText.split(" (")[0];
        const size=row.querySelector(".size").value;
        const qty=parseInt(row.querySelector(".qty").value);
        if(qty>0){
          const price = products[pname].price;
          const line=price*qty;
          total+=line;
          cartBody.innerHTML+=`<tr>
            <td>${pname}</td>
            <td>${size}</td>
            <td>${qty}</td>
            <td>R${line.toFixed(2)}</td>
            <td><button type="button" class="remove-btn" data-item="${pname}">X</button></td>
          </tr>`;
        }
      });
      if(cartBody.innerHTML===""){ cartBody.innerHTML='<tr><td colspan="5" class="muted">No items</td></tr>'; }
      document.getElementById("grandTotal").innerText=`Total: R${total.toFixed(2)}`;
    }

    document.querySelectorAll(".qty").forEach(input=>{
      input.addEventListener("input",updateCart);
    });

    document.addEventListener("click",function(e){
      if(e.target.classList.contains("remove-btn")){
        const item = e.target.dataset.item;
        document.querySelectorAll(".product-row").forEach(row=>{
          if(row.querySelector(".pname").innerText.split(" (")[0]===item){
            row.querySelector(".qty").value=0;
          }
        });
        updateCart();
      }
    });

    // =======================
    // PDF generation
    document.getElementById("generatePDF").addEventListener("click", async ()=>{
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("SA College Private School - Uniform Order", 14, 16);
      const rows=[];
      document.querySelectorAll(".product-row").forEach(row=>{
        const pname=row.querySelector(".pname").innerText.split(" (")[0];
        const size=row.querySelector(".size").value;
        const qty=parseInt(row.querySelector(".qty").value);
        if(qty>0){
          rows.push([pname, size, qty]);
        }
      });
      if(rows.length>0){
        doc.autoTable({ head:[["Item","Size","Qty"]], body:rows, startY:25 });
        doc.save("Uniform_Order.pdf");
      } else {
        alert("No items in cart to generate PDF");
      }
    });

    // =======================
    // Send email (EmailJS)
    document.getElementById("sendEmail").addEventListener("click",()=>{
      const parentName=document.getElementById("parentName").value;
      const contactNumber=document.getElementById("contactNumber").value;
      const email=document.getElementById("email").value;
      const learnerName=document.getElementById("learnerName").value;
      const grade=document.getElementById("grade").value;
      const schoolLevel=document.getElementById("schoolLevel").value;
      const adminNumber=document.getElementById("adminNumber").value;

      const orderDetails = Array.from(document.querySelectorAll(".product-row"))
        .filter(r=>parseInt(r.querySelector(".qty").value)>0)
        .map(r=>`${r.querySelector(".pname").innerText} | Size: ${r.querySelector(".size").value} | Qty: ${r.querySelector(".qty").value}`)
        .join("<br>");

      if(!orderDetails){ alert("No items selected"); return; }

      const templateParams = {
        parentName, contactNumber, email, learnerName, grade, schoolLevel, adminNumber,
        orderDetails
      };

      emailjs.send('default_service', 'uniform_order', templateParams)
      .then(()=>alert("Order email sent successfully!"))
      .catch(e=>alert("Failed to send order: "+e));
    });
  </script>
</body>
</html>
