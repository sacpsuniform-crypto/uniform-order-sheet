<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SA College Private School - Uniform Order</title>

  <!-- =========================
       Libraries
       ========================= -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){
      try {
        emailjs.init("GEyF3k2gS9_KFma8Y");
        console.log("EmailJS initialized");
      } catch (e) {
        console.warn("EmailJS init failed:", e);
      }
    })();
  </script>

  <!-- jsPDF and autotable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root{
      --navy: #00274d;
      --gold: #ffc107;
      --white: #ffffff;
      --muted: #f4f6f8;
      --accent: #0f7b3a;
    }
    html,body{
      margin:0;
      padding:0;
      height:100%;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--muted);
      color:#111;
    }

    header.site-header{
      background: linear-gradient(90deg, rgba(0,39,77,1) 0%, rgba(0,39,77,0.95) 60%);
      color:var(--white);
      padding:14px 20px;
      display:flex;
      gap:18px;
      align-items:center;
    }
    header.site-header img.logo{
      height:78px;
      width:auto;
      border-radius:8px;
      box-shadow:0 3px 8px rgba(0,0,0,0.2);
      background:var(--white);
      padding:4px;
    }
    header.site-header .heading h1{
      font-size:20px;
      margin:0;
    }

    .braten-notice{
      background:#ffc;
      border-left:5px solid var(--gold);
      padding:10px 18px;
      margin-bottom:12px;
      font-size:13px;
    }

    .page {
      max-width:1200px;
      margin:18px auto;
      padding:10px;
    }

    form#orderForm {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
    }

    .left {
      background:var(--white);
      border-radius:10px;
      padding:18px;
      box-shadow:0 4px 10px rgba(0,0,0,0.04);
    }

    .form-row { display:flex; gap:12px; margin-bottom:10px; }
    .form-row .field { flex:1; }
    label{
      display:block;
      font-size:13px;
      margin-bottom:6px;
      color:#222;
    }
    input[type="text"], input[type="email"], select {
      width:100%;
      padding:8px 10px;
      border-radius:6px;
      border:1px solid #d7dbe0;
      font-size:14px;
      box-sizing:border-box;
      background:#fff;
    }

    .category-card {
      border-radius:8px;
      background:linear-gradient(180deg, #ffffff 0%, #fcfcfc 100%);
      border:1px solid #e8eef7;
      padding:10px;
      margin-bottom:12px;
    }
    .category-card .cat-header{
      background:var(--navy);
      color:var(--white);
      padding:8px 10px;
      border-radius:6px;
      font-weight:700;
      margin:-10px -10px 10px -10px;
    }

    .product-row{
      display:flex;
      gap:10px;
      align-items:center;
      padding:8px 0;
      border-bottom:1px dashed #eef3fb;
    }
    .product-row:last-child{ border-bottom:none; }
    .product-row .pname { flex:1; font-weight:600; color:#222; font-size:14px; }
    .product-row select.size { width:110px; padding:6px; border-radius:6px; border:1px solid #d7dbe0; }
    .product-row input.qty { width:70px; padding:6px; border-radius:6px; border:1px solid #d7dbe0; }

    /* HEADINGS ABOVE SIZE & QTY */
    .size-qty-heading {
      display: flex;
      gap: 10px;
      margin-bottom: 6px;
      align-items: flex-end;
    }
    .size-qty-heading .item-col {
      flex: 1;
      font-weight: 700;
      font-size: 13px;
      text-align: left;
    }
    .size-qty-heading .size-col {
      width: 110px;
      font-weight: 700;
      font-size: 13px;
      text-align: center;
    }
    .size-qty-heading .qty-col {
      width: 70px;
      font-weight: 700;
      font-size: 13px;
      text-align: center;
    }

    .cart {
      background:var(--white);
      border-radius:10px;
      padding:16px;
      box-shadow:0 4px 10px rgba(0,0,0,0.04);
      position:sticky;
      top:18px;
      height:fit-content;
    }
    table.cart-table{
      width:100%;
      border-collapse:collapse;
      margin-top:8px;
      font-size:14px;
    }
    table.cart-table th{
      background:var(--navy);
      color:var(--white);
      font-weight:600;
      font-size:13px;
    }
    .cart .total {
      margin-top:10px;
      font-weight:700;
      font-size:16px;
      color:#111;
    }

    .btn {
      display:inline-block;
      padding:10px 14px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:14px;
    }
    .btn-primary { background:var(--navy); color:var(--white); }
    .btn-gold { background:var(--gold); color:#111; margin-top:12px; width:100%; }

    @media(max-width:980px){
      form#orderForm { grid-template-columns: 1fr; }
      .cart { position:relative; top:auto; }
    }

    .muted { color:#6b7280; font-size:13px; }
  </style>
</head>
<body>
  <header class="site-header">
    <img class="logo" id="schoolLogo" src="logo.jpg" alt="SA College Private School logo" />
    <div class="heading">
      <h1>SA College Private School</h1>
      <p class="muted">admin@sacps.co.za • info@sacps.co.za • uniformsacps@gmail.com • Tel: 012 326 4580 / 064 548 9428</p>
    </div>
  </header>

  <div class="braten-notice">
    SA College private school is using Reaora in an attempt to provide uniforms at a more affordable price to parents. SACPS will still be using Select Outfitters and parents are welcome to use them. All orders placed now will be delivered at school and given to your child before the last day of school, ready for January 2026 with no need to stand in queues.
  </div>

  <main class="page">
    <form id="orderForm" autocomplete="off">
      <div class="left">
        <div class="section">
          <h2 style="margin-top:0; color:var(--navy)">Parent & Learner Information</h2>
          <div class="form-row">
            <div class="field"><label for="parentName">Parent Name</label><input id="parentName" type="text" required></div>
            <div class="field"><label for="contactNumber">Contact Number</label><input id="contactNumber" type="text" required></div>
          </div>
        </div>

        <!-- Products -->
        <div class="section" id="productsSection">
          <h2 style="margin-top:0; color:var(--navy)">Uniforms & Sports</h2>

          <div class="category-card">
            <div class="cat-header">Tracksuits</div>
            <div class="size-qty-heading">
              <div class="item-col">Item</div>
              <div class="size-col">Size</div>
              <div class="qty-col">Quantity</div>
            </div>
            <div class="card-body"></div>
          </div>

          <div class="category-card">
            <div class="cat-header">Jerseys & Pullovers</div>
            <div class="size-qty-heading">
              <div class="item-col">Item</div>
              <div class="size-col">Size</div>
              <div class="qty-col">Quantity</div>
            </div>
            <div class="card-body"></div>
          </div>

          <div class="category-card">
            <div class="cat-header">Formal</div>
            <div class="size-qty-heading">
              <div class="item-col">Item</div>
              <div class="size-col">Size</div>
              <div class="qty-col">Quantity</div>
            </div>
            <div class="card-body"></div>
          </div>

          <div class="category-card">
            <div class="cat-header">Sportswear</div>
            <div class="size-qty-heading">
              <div class="item-col">Item</div>
              <div class="size-col">Size</div>
              <div class="qty-col">Quantity</div>
            </div>
            <div class="card-body"></div>
          </div>

          <div class="category-card">
            <div class="cat-header">Accessories</div>
            <div class="size-qty-heading">
              <div class="item-col">Item</div>
              <div class="size-col">Size</div>
              <div class="qty-col">Quantity</div>
            </div>
            <div class="card-body"></div>
          </div>

        </div>
      </div>

      <aside class="cart">
        <h3>Your Cart</h3>
        <div class="muted">Add quantities for the items on the left and the cart will update automatically.</div>
        <table class="cart-table" id="cartTable">
          <thead>
            <tr>
              <th style="width:42%;">Item</th>
              <th style="width:18%;">Size</th>
              <th style="width:10%;">Qty</th>
              <th style="width:14%;">Line</th>
              <th style="width:10%;">Remove</th>
            </tr>
          </thead>
          <tbody id="cartBody">
            <tr><td colspan="5" class="muted">No items</td></tr>
          </tbody>
        </table>

        <div class="total" id="grandTotal">Total: R0.00</div>
        <button type="submit" class="btn btn-gold">Submit Order & Download Receipt</button>
      </aside>
    </form>
  </main>
</body>

  <script>
    (function(){
      const primarySizes = ['5-6','6-7','7-8','8-9','9-10','10-11','11-12','12-13','13-14'];
      const highschoolSizes = ['13-14','14-15','15-16','16-17','17-18','18-20'];
      const blazerSizes = ['28','30','32','34','36','38','40','42'];
      const oneSize = ['One Size'];
      const allSizes = [...primarySizes, ...highschoolSizes];

      const categories = {
        "Tracksuits": [
          {id:"tracksuit_primary",name:"Primary Tracksuit Set",price:600,sizes:primarySizes},
          {id:"tracksuit_hs",name:"Highschool Tracksuit Set",price:650,sizes:highschoolSizes}
        ],
        "Jerseys & Pullovers": [
          {id:"jersey_hs",name:"Highschool Jersey",price:260,sizes:highschoolSizes},
          {id:"jersey_primary",name:"Primary Jersey",price:250,sizes:primarySizes}
        ],
        "Formal": [
          {id:"blazer",name:"Blazer",price:700,sizes:blazerSizes},
          {id:"tie",name:"School Tie",price:80,sizes:oneSize}
        ],
        "Sportswear": [
          {id:"sport_shirt",name:"Sport Shirt",price:345,sizes:allSizes}
        ],
        "Accessories": [
          {id:"green_socks",name:"Long Green Socks",price:55,sizes:oneSize}
        ]
      };

      function createProductRow(item){
        const row = document.createElement('div');
        row.className = 'product-row item-row';
        row.dataset.itemId = item.id;
        row.dataset.price = item.price;

        const nameSpan = document.createElement('div');
        nameSpan.className = 'pname';
        nameSpan.textContent = `${item.name} — R${item.price}`;

        const sizeSel = document.createElement('select');
        sizeSel.className = 'size';
        item.sizes.forEach(s=>{
          const opt = document.createElement('option');
          opt.value = s;
          opt.textContent = s;
          sizeSel.appendChild(opt);
        });

        const qtyInput = document.createElement('input');
        qtyInput.className = 'qty';
        qtyInput.type = 'number';
        qtyInput.min = 0;
        qtyInput.value = 0;

        row.appendChild(nameSpan);
        row.appendChild(sizeSel);
        row.appendChild(qtyInput);

        return row;
      }

      document.addEventListener('DOMContentLoaded', function(){
        const mapping = {
          "cat-tracksuits": "Tracksuits",
          "cat-jerseys": "Jerseys & Pullovers",
          "cat-formal": "Formal",
          "cat-sports": "Sportswear",
          "cat-accessories": "Accessories"
        };
        Object.entries(mapping).forEach(([cardId,catName])=>{
          const card = document.getElementById(cardId);
          const body = card.querySelector('.card-body');
          categories[catName].forEach(item=>{
            body.appendChild(createProductRow(item));
          });
        });

        document.querySelectorAll('.qty').forEach(q=>{
          q.addEventListener('input', updateCart);
        });
        document.querySelectorAll('.size').forEach(s=>{
          s.addEventListener('change', updateCart);
        });

        document.getElementById('orderForm').addEventListener('submit', handleSubmit);
      });

      function updateCart(){
        const cartBody = document.getElementById('cartBody');
        cartBody.innerHTML = '';
        let total = 0;

        document.querySelectorAll('.item-row').forEach(row=>{
          const qty = parseInt(row.querySelector('.qty').value,10) || 0;
          if(qty>0){
            const name = row.querySelector('.pname').textContent.split(' — ')[0];
            const size = row.querySelector('.size').value;
            const price = parseFloat(row.dataset.price);
            const line = qty*price;
            total += line;

            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${name}</td><td>${size}</td><td>${qty}</td><td>R${line.toFixed(2)}</td><td><button type="button" class="btn-remove" style="background:none;border:none;cursor:pointer;font-size:16px;">❌</button></td>`;
            tr.querySelector('.btn-remove').addEventListener('click',()=>{
              row.querySelector('.qty').value = 0;
              updateCart();
            });
            cartBody.appendChild(tr);
          }
        });

        if(cartBody.innerHTML===''){
          cartBody.innerHTML = '<tr><td colspan="5" class="muted">No items</td></tr>';
        }

        document.getElementById('grandTotal').textContent = `Total: R${total.toFixed(2)}`;
      }

      async function handleSubmit(e){
        e.preventDefault();
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();

        const parentName = document.getElementById('parentName').value;
        const contactNumber = document.getElementById('contactNumber').value;
        const email = document.getElementById('email').value;
        const learnerName = document.getElementById('learnerName').value;
        const grade = document.getElementById('grade').value;
        const schoolLevel = document.getElementById('schoolLevel').value;
        const adminNumber = document.getElementById('adminNumber').value;

        pdf.setFontSize(16);
        pdf.text("SA College Private School - Uniform Order Receipt", 14, 20);
        pdf.setFontSize(11);
        pdf.text(`Parent: ${parentName}`, 14, 30);
        pdf.text(`Contact: ${contactNumber}`, 14, 36);
        pdf.text(`Email: ${email}`, 14, 42);
        pdf.text(`Learner: ${learnerName}`, 14, 48);
        pdf.text(`Grade: ${grade} (${schoolLevel})`, 14, 54);
        pdf.text(`Admin #: ${adminNumber}`, 14, 60);
        pdf.text(`Date: ${new Date().toLocaleDateString()}`, 14, 66);

        const rows = [];
        let total = 0;
        document.querySelectorAll('.item-row').forEach(row=>{
          const qty = parseInt(row.querySelector('.qty').value,10) || 0;
          if(qty>0){
            const name = row.querySelector('.pname').textContent.split(' — ')[0];
            const size = row.querySelector('.size').value;
            const price = parseFloat(row.dataset.price);
            const line = qty*price;
            total += line;
            rows.push([name,size,qty,`R${price.toFixed(2)}`,`R${line.toFixed(2)}`]);
          }
        });

        pdf.autoTable({
          startY: 75,
          head: [['Item','Size','Qty','Unit Price','Total']],
          body: rows.length>0?rows:[['(no items)','-','-','-','-']]
        });

        pdf.setFontSize(14);
        pdf.text(`Grand Total: R${total.toFixed(2)}`, 14, pdf.lastAutoTable.finalY + 12);

        pdf.save(`Uniform-Order-${learnerName}.pdf`);

        const formData = {
          parentName, contactNumber, email, learnerName, grade, schoolLevel, adminNumber, total, rows
        };

        try {
          await emailjs.send("service_8uuj8u8","template_vw72z3m",formData);
          alert("✅ Order submitted successfully. A PDF receipt has been downloaded. Please email your proof of payment.");
        } catch(err){
          console.warn("Email failed:",err);
          alert("Order saved. PDF receipt downloaded. Email sending failed — please send proof of payment manually.");
        }
      }
    })();
  </script>
</body>
</html>

